#!/usr/bin/ruby

html_string = <<-html
<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 shrink-to-fit=no"> <meta name="author" content=""> <meta name="robots" content="index,follow"> <meta name="googlebot" content="index,follow"> <meta name="generator" content="jekyll"> <link rel="author" href="humans.txt"> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <title>Home</title> <meta name="description" content=""> <meta name="author" content=""> <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <script>
var menu_data = [{"title":"Home","url":"/"},{"title":"Impressum","url":"/impressum","sub":[{"title":"Sub Impressum","url":"impressum/sub/"},{"title":"Sub2 Impressum","url":"impressum/sub2/"}]}];
</script> </head> <body class="fade"> <header> <div class="inner"> <nav> <a href="/" class="logo"></a> <input type="checkbox" id="nav"/> <label for="nav"></label> <a href="#" id="menu-icon"></a> <ul id="menu-list"> <li class="menu-item"> <a href="/">Home</a> </li> <li class="menu-item"><a href="#a-dead-simple-theme-boilerplate" class="jump-link">A dead simple theme boilerplate…</a></li> <li class="menu-item"><a href="#text" class="jump-link">Text</a></li> <li class="menu-item" id="last-item"> <a href="/impressum">Impressum</a> <ul class="sub-list"> <li class="menu-item sub-item"><a href="impressum/sub/">Sub Impressum</a></li> <li class="menu-item sub-item"><a href="impressum/sub2/">Sub2 Impressum</a></li> </ul> </li> </ul> </nav> </div> </header> <section> <div id="main"> <div class="menu-trigger"></div> <h1 id="徒弟-tou-dai--student--disciple">徒弟 (Tou Dai) – Student / Disciple</h1> <p>Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag.</p> <h2 id="a-dead-simple-theme-boilerplate">A dead simple theme boilerplate…</h2> <p>Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag.</p> <p><img src="assets/images/pexels-photo-127028.jpg" alt="kitty"/></p> <p>Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. <br/> Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag.</p> <h3 id="some-code">Some Code</h3> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* global document */</span>
<span class="k">import</span> <span class="nx">jump</span> <span class="k">from</span> <span class="s1">'jump.js'</span><span class="p">;</span>

<span class="c1">// import easeInOutQuad from './easing';</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">ez</span> <span class="k">from</span> <span class="s1">'ez.js'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">easeInOutQuint</span> <span class="k">from</span> <span class="s1">'ez.js'</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">key</span> <span class="k">of</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">ez</span><span class="p">))</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"key"</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ez</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">ready</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'document-ready'</span><span class="p">);</span>
<span class="nx">ready</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'DOM is ready'</span><span class="p">);</span>
<span class="c1">// We get all h2 elements</span>
<span class="kd">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">'jump-link'</span><span class="p">);</span>
<span class="c1">// Get the menu ul</span>
<span class="kd">const</span> <span class="nx">menuList</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'menu-list'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="c1">// Isolate</span>
<span class="kd">let</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">jump</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="p">{</span>
	<span class="na">duration</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span>
	<span class="na">callback</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'did the jump!'</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="na">easing</span><span class="p">:</span> <span class="nx">easeInOutQuint</span><span class="p">,</span>
	<span class="na">a11y</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">})</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div> <h3 id="quote">Quote</h3> <blockquote> <p>Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag.</p> </blockquote> <h2 id="text">Text</h2> <p>Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. <code class="highlighter-rouge">var foo = "bah";</code> Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag.</p> <h3 id="subtext">Subtext</h3> <p>Bla bla bla. Blub blah bla bla. Bla bla. Bla bla bla blah <strong>blah</strong> <em>blag</em>. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag. Bla blah bla bla blah blah. Bla bla. Bla bla bla blah blah blag.</p> <footer> <p>Build with <a href="http://jekyllrb.com/" target="blank">jekyll</a> and &hearts; </p> </footer> </div> </section> <script type="text/javascript" src="http://localhost:4000/assets/js/main.bundle.js"></script> </body> </html>
html

require 'nokogiri'

doc = Nokogiri::HTML(html_string)
# In the below line, I am first creating the array of elements to search 
# in the html document. You may call it also array of CSS rules.
header_tags = (2..3).map { |num| "h#{num}" }
# => ["h1", "h2", "h3", "h4", "h5", "h6"]
# puts header_tags
headers = []
tags = doc.xpath("//h2 | //h3")

tags.each do |n|
	headers << {"node" => n.name, "value" => n.content, "id" => n["id"] }
end

insub = false
headers.each_with_index {
	|ele, i|
	if ele["node"] == "h3"
		insub = true
		headers[i]["issub"] = insub
		headers[i]["html"] = "<li class=\"ish3 menu-item sub-item\"><a href=\"\##{ele["id"]}\">#{ele["value"]}</a></li>\n"
	else
		insub = false
		headers[i]["issub"] = insub
		headers[i]["html"] = "<li class=\"ish2 menu-item\"><a href=\"\##{ele["id"]}\">#{ele["value"]}</a></li>\n"
	end
}

html_str = ""
headers.each_with_index {
	|ele, i|
	if i != 0
		if ele["issub"] == true
			if headers[i-1]["issub"] != true
				html_str += "<ul>\n"
			end
		elsif ele["issub"] == false && headers[i-1]["issub"] == true
			html_str += "</ul>\n"
		end
		html_str += ele["html"]		
	else
		html_str += ele["html"]
	end
	if i == headers.length - 1
		if ele["issub"] == true
			html_str+="</ul>\n"
		end
	end
}
puts html_str